---
import Layout from '@/layouts/Layout.astro'
import { RoasteriesListView } from '@/components/roasteries/RoasteriesListView'

export const prerender = false

// Parse and validate query params
const url = new URL(Astro.request.url)
const rawPage = url.searchParams.get('page')
const rawPageSize = url.searchParams.get('pageSize')

// Validate page: must be positive integer, default to 1
const parsedPage = rawPage ? parseInt(rawPage, 10) : 1
const page = Number.isInteger(parsedPage) && parsedPage >= 1 ? parsedPage : 1

// Validate pageSize: must be integer in range 1-100, default to 20
const parsedPageSize = rawPageSize ? parseInt(rawPageSize, 10) : 20
const pageSize = Number.isInteger(parsedPageSize) && parsedPageSize >= 1 && parsedPageSize <= 100 
  ? parsedPageSize 
  : 20

const initialQuery = { page, pageSize }
---

<Layout title="Palarnie">
  <RoasteriesListView 
    client:load 
    initialQuery={initialQuery}
  />
</Layout>
